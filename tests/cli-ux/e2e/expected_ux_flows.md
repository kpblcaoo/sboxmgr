# Expected UX Flows

**Цель:** Описание ожидаемых пользовательских сценариев для контроля UX при рефакторинге CLI.

## 1. Новый пользователь (Onboarding)

### Flow: Первый запуск
1. Пользователь устанавливает sboxmgr
2. Запускает `sboxctl` без параметров
3. Видит приветственное сообщение и основные команды
4. Рекомендуется запустить `sboxctl wizard`

### Flow: Интерактивный wizard
1. Пользователь запускает `sboxctl wizard`
2. Видит пошаговые prompts:
   - Subscription URL (обязательно)
   - Inbound types (по умолчанию: tun)
   - TUN configuration (если выбран)
   - SOCKS/HTTP configuration (если выбраны)
   - Output format (по умолчанию: JSON)
   - Output file (по умолчанию: config.json)
3. Видит summary перед сохранением
4. Получает подтверждение успеха
5. Рекомендуется запустить `sboxctl export generate`

### Flow: Быстрый старт
1. Пользователь запускает `sboxctl wizard quick-start`
2. Вводит только subscription URL
3. Применяются разумные defaults
4. Создается базовая конфигурация

## 2. Опытный пользователь (Power User)

### Flow: Использование активной конфигурации
1. Пользователь имеет активную конфигурацию "production"
2. Запускает `sboxctl export generate` без параметров
3. CLI автоматически использует URL и настройки из активной конфигурации
4. Показывается сообщение "Using active configuration: production"

### Flow: Автоматизация с глобальными флагами
1. Пользователь использует `--yes` для пропуска подтверждений
2. Использует `--verbose` для подробного вывода
3. Использует `--format json` для машинно-читаемого вывода
4. Использует `--version` для быстрой проверки версии

### Flow: Batch операции
1. Пользователь включает несколько политик: `sboxctl policy enable Policy1,Policy2`
2. Исключает несколько серверов: `sboxctl exclusions add 1,2,3 --reason "Slow"`
3. Получает подтверждение для каждой операции

### Flow: Диагностика системы
1. Пользователь запускает `sboxctl diagnose`
2. Видит проверку:
   - Подключения к подписке
   - Валидности конфигурации
   - Сетевого подключения
   - Общего состояния системы
3. Получает рекомендации по исправлению проблем

## 3. Миграция со старой структуры

### Flow: Использование deprecated команд
1. Пользователь запускает `sboxctl list-servers`
2. Видит предупреждение: "Warning: 'list-servers' is deprecated, use 'subscription list'"
3. Команда работает как раньше
4. Рекомендуется использовать новую команду

### Flow: Переход на новую структуру
1. Пользователь заменяет `list-servers` на `subscription list`
2. Заменяет `exclusions` на `subscription exclusions list`
3. Заменяет `export --dry-run` на `export dry-run`
4. Не видит предупреждений
5. Получает улучшенный UX

## 4. Интерактивные prompts

### Flow: Prompts в существующих командах
1. Пользователь запускает `sboxctl export` без URL
2. CLI показывает prompt: "Subscription URL:"
3. Пользователь вводит URL
4. CLI продолжает выполнение

### Flow: Валидация в prompts
1. Пользователь вводит невалидный URL
2. CLI показывает ошибку валидации
3. Prompt повторяется
4. Пользователь вводит валидный URL

### Flow: Отмена в prompts
1. Пользователь вводит "cancel" в любой prompt
2. CLI выходит с сообщением "Operation cancelled"
3. Никакие изменения не сохраняются

## 5. Обработка ошибок

### Flow: Валидационные ошибки
1. Пользователь вводит невалидные данные
2. CLI показывает понятное сообщение об ошибке
3. Объясняется, что нужно исправить
4. Предлагается помощь: `sboxctl --help`

### Flow: Сетевые ошибки
1. CLI не может подключиться к subscription URL
2. Показывается ошибка с кодом 4
3. Предлагается проверить URL и сетевое подключение
4. Рекомендуется `sboxctl diagnose network`

### Flow: Ошибки конфигурации
1. CLI не может найти конфигурационный файл
2. Показывается ошибка с кодом 6
3. Предлагается создать конфигурацию: `sboxctl wizard`

## 6. Help и документация

### Flow: Основной help
1. Пользователь запускает `sboxctl --help`
2. Видит организованные группы команд:
   - subscription (работа с подписками)
   - export (экспорт конфигураций)
   - config (управление конфигурациями)
   - policy (управление политиками)
   - wizard (интерактивная настройка)
   - diagnose (диагностика системы)

### Flow: Help подкоманд
1. Пользователь запускает `sboxctl subscription --help`
2. Видит подкоманды:
   - list (список серверов)
   - exclusions (управление исключениями)
   - info (информация о подписке)
   - validate (проверка подписки)

### Flow: Help с примерами
1. Пользователь запускает `sboxctl export --help`
2. Видит примеры использования
3. Видит описание всех опций
4. Видит ссылки на документацию

## 7. Интеграция и автоматизация

### Flow: JSON вывод для скриптов
1. Пользователь запускает `sboxctl subscription list --format json`
2. Получает валидный JSON с полями:
   - status: "success"
   - data: { servers: [...], total: N, filtered: N, excluded: N }

### Flow: Exit codes для CI/CD
1. Успешное выполнение: код 0
2. Ошибка валидации: код 2
3. Ошибка конфигурации: код 3
4. Сетевая ошибка: код 4
5. Ошибка прав доступа: код 5
6. Файл не найден: код 6

### Flow: Non-interactive режим
1. CLI запущен в non-TTY окружении
2. Не показывает интерактивные prompts
3. Использует значения по умолчанию
4. Возвращает ошибку, если обязательные параметры отсутствуют

## 8. Bash completion

### Flow: Автодополнение команд
1. Пользователь вводит `sboxctl ` и нажимает Tab
2. Видит список доступных команд
3. Вводит `sboxctl subscription ` и нажимает Tab
4. Видит подкоманды subscription

### Flow: Автодополнение опций
1. Пользователь вводит `sboxctl export --` и нажимает Tab
2. Видит список доступных опций
3. Вводит `sboxctl --` и нажимает Tab
4. Видит глобальные опции

## Критерии успеха

### Для новичков
- [ ] Могут настроить sboxmgr за 5 минут с wizard
- [ ] Понимают все prompts без документации
- [ ] Получают понятные сообщения об ошибках
- [ ] Могут найти нужную команду через help

### Для опытных пользователей
- [ ] Могут автоматизировать все операции
- [ ] Получают стабильный JSON-вывод
- [ ] Используют глобальные флаги эффективно
- [ ] Могут диагностировать проблемы быстро

### Для разработчиков
- [ ] Exit codes предсказуемы
- [ ] CLI работает в CI/CD
- [ ] Тесты покрывают все сценарии
- [ ] Документация актуальна
