# Export Command Module

Модульная реализация команды `sboxctl export` для генерации конфигураций из подписок.

## Структура модуля

```
export/
├── __init__.py              # Точка входа и экспорт основных функций
├── cli.py                   # Основная CLI команда
├── validators.py            # Валидация параметров командной строки
├── profile_loaders.py       # Загрузка профилей из файлов
├── config_generators.py     # Генерация конфигураций из подписок
├── file_handlers.py         # Операции с файлами (запись, бэкап)
├── mode_handlers.py         # Обработка различных режимов выполнения
├── chain_builders.py        # Создание цепочек постпроцессоров и middleware
├── constants.py             # Константы валидации и значения по умолчанию
└── README.md               # Этот файл
```

## Принципы рефакторинга

### 1. Единственная ответственность (SRP)
Каждый модуль имеет четко определенную область ответственности:
- **validators.py** - только валидация
- **file_handlers.py** - только файловые операции
- **config_generators.py** - только генерация конфигураций

### 2. Модульность
Большой монолитный файл (1287 строк) разделен на 9 специализированных модулей.

### 3. Переиспользование
Функции сгруппированы по логическим блокам, что упрощает их переиспользование.

### 4. Читаемость
Каждый модуль легко понять и модифицировать независимо от других.

## Режимы работы

Команда поддерживает несколько режимов:

- **Default**: Генерация и сохранение конфигурации
- **--dry-run**: Валидация без сохранения
- **--agent-check**: Проверка через sboxagent
- **--validate-only**: Валидация существующего файла

## Обратная совместимость

Основной файл `export.py` сохранен как слой совместимости, который импортирует функциональность из нового модуля.

## Архитектурные решения

- **ADR-0014 совместимость**: sboxmgr только генерирует конфигурации, sboxagent управляет сервисами
- **Phase 3 поддержка**: Опциональная поддержка профилей и продвинутых функций
- **Graceful degradation**: Корректная работа при отсутствии зависимостей

## Статистика

- **До рефакторинга**: 1 файл, 1287 строк
- **После рефакторинга**: 9 файлов, 1403 строки
- **Прирост**: +116 строк за счет лучшей документации и структуры

## Использование

```python
# Импорт основной команды
from sboxmgr.cli.commands.export import export, app

# Импорт отдельных модулей
from sboxmgr.cli.commands.export.validators import validate_postprocessors
from sboxmgr.cli.commands.export.file_handlers import write_config_to_file
``` 