# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞: profiles ‚Üí configs + TOML

**–î–∞—Ç–∞:** 2024-12-19
**–í–µ—Ç–∫–∞:** feature/profile-to-config-migration
**–¶–µ–ª—å:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ profiles –≤ configs —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º TOML –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## üéØ **–¶–ï–õ–¨ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê**

–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É –≤ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ "–ø—Ä–æ—Ñ–∏–ª–∏" –∏ —É–ª—É—á—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:
- **profiles** ‚Üí **configs** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- **–î–æ–±–∞–≤–∏—Ç—å TOML –ø–æ–¥–¥–µ—Ä–∂–∫—É** –¥–ª—è –ª—É—á—à–µ–≥–æ UX
- **–û—Å—Ç–∞–≤–∏—Ç—å JSON —Ç–æ–ª—å–∫–æ –¥–ª—è ClientConfig** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —ç–∫—Å–ø–æ—Ä—Ç)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** configs/*.toml

## üìã **–ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø**

### –≠—Ç–∞–ø 1: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π
- [ ] `FullProfile` ‚Üí `UserConfig`
- [ ] `SubscriptionProfile` ‚Üí `SubscriptionConfig`
- [ ] `FilterProfile` ‚Üí `FilterConfig`
- [ ] `RoutingProfile` ‚Üí `RoutingConfig`
- [ ] `ExportProfile` ‚Üí `ExportConfig`
- [ ] `AgentProfile` ‚Üí `AgentConfig`
- [ ] `UIProfile` ‚Üí `UIConfig`
- [ ] `ClientProfile` ‚Üí `ClientConfig` (–æ—Å—Ç–∞–µ—Ç—Å—è JSON)
- [ ] `InboundProfile` ‚Üí `InboundConfig` (–æ—Å—Ç–∞–µ—Ç—Å—è JSON)

### –≠—Ç–∞–ø 2: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –∏ –ø–∞–∫–µ—Ç–æ–≤
- [ ] `src/sboxmgr/profiles/` ‚Üí `src/sboxmgr/configs/`
- [ ] `src/sboxmgr/profiles/models.py` ‚Üí `src/sboxmgr/configs/models.py`
- [ ] `src/sboxmgr/profiles/loader.py` ‚Üí `src/sboxmgr/configs/loader.py`
- [ ] `src/sboxmgr/profiles/manager.py` ‚Üí `src/sboxmgr/configs/manager.py`
- [ ] `src/sboxmgr/profiles/cli.py` ‚Üí `src/sboxmgr/configs/cli.py`

### –≠—Ç–∞–ø 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ TOML –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å ConfigLoader –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ TOML
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å toml –≤ pyproject.toml
- [ ] –°–æ–∑–¥–∞—Ç—å TOML —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é TOML —Ñ–∞–π–ª–æ–≤

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLI –∫–æ–º–∞–Ω–¥
- [ ] `sboxctl profile` ‚Üí `sboxctl config`
- [ ] `sboxctl config list` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] `sboxctl config apply home.toml` - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] `sboxctl config switch work` - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] `sboxctl config edit home` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] `sboxctl config create` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –≠—Ç–∞–ø 5: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- [ ] `~/.config/sboxmgr/profiles/` ‚Üí `~/.config/sboxmgr/configs/`
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞: `configs/{name}.toml`
- [ ] –°–æ–∑–¥–∞—Ç—å default.toml –∫–∞–∫ –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö JSON –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ TOML

### –≠—Ç–∞–ø 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ profile ‚Üí config
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã TOML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å CLI —Å–ø—Ä–∞–≤–∫—É
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã —Å –Ω–æ–≤–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π
- [ ] –¢–µ—Å—Ç—ã TOML –∑–∞–≥—Ä—É–∑–∫–∏/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] –¢–µ—Å—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ JSON ‚Üí TOML
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã CLI –∫–æ–º–∞–Ω–¥

## üóÇÔ∏è **–°–¢–†–£–ö–¢–£–†–ê –ü–û–°–õ–ï –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê**

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (TOML):
```
~/.config/sboxmgr/configs/
‚îú‚îÄ‚îÄ default.toml         # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ home.toml           # –î–æ–º–∞—à–Ω—è—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ work.toml           # –†–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ travel.toml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π
```

### –ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
src/sboxmgr/configs/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ models.py           # UserConfig, SubscriptionConfig, etc.
‚îú‚îÄ‚îÄ loader.py           # ConfigLoader —Å TOML –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
‚îú‚îÄ‚îÄ manager.py          # ConfigManager
‚îú‚îÄ‚îÄ cli.py             # CLI –∫–æ–º–∞–Ω–¥—ã
‚îî‚îÄ‚îÄ migrator.py        # –ú–∏–≥—Ä–∞—Ü–∏—è JSON ‚Üí TOML
```

## üìù **–ü–†–ò–ú–ï–† TOML –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò**

```toml
# ~/.config/sboxmgr/configs/home.toml
id = "home"
description = "–î–æ–º–∞—à–Ω—è—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"
version = "1.0"

[subscriptions]
# –ü–æ–¥–ø–∏—Å–∫–∏
[[subscriptions.sources]]
id = "main"
url = "https://my-provider.com/subscription"
enabled = true
priority = 1

[filters]
# –§–∏–ª—å—Ç—Ä—ã
exclude_tags = ["blocked", "slow"]
only_tags = ["premium"]
exclusions = ["bad-server.com"]

[routing]
# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
default_route = "tunnel"
[routing.custom_routes]
"youtube.com" = "direct"
"github.com" = "direct"

[export]
# –≠–∫—Å–ø–æ—Ä—Ç
format = "sing-box"
inbound_types = ["socks", "http"]
socks_port = 1080
http_port = 8080
output_file = "home-config.json"

[agent]
# –ê–≥–µ–Ω—Ç
auto_restart = true
monitor_latency = true
health_check_interval = "30s"
log_level = "info"

[ui]
# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
default_language = "ru"
mode = "cli"
show_debug_info = false
```

## üîÑ **–ú–ò–ì–†–ê–¶–ò–Ø**

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è:
```bash
# –ú–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö JSON –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ TOML
sboxctl config migrate --from ~/.config/sboxmgr/profiles/ --to ~/.config/sboxmgr/configs/

# –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
sboxctl config migrate --profile home.json --output home.toml
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- JSON –ø—Ä–æ—Ñ–∏–ª–∏ –±—É–¥—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ deprecated JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üöÄ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ü–û–°–õ–ï –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê**

1. **–Ø—Å–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è**: config –≤–º–µ—Å—Ç–æ profile
2. **–õ—É—á—à–∏–π UX**: TOML —á–∏—Ç–∞–µ–º–µ–µ JSON
3. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: TOML –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: configs/*.toml –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
5. **CLI –¥—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å**: –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã config
6. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏

## üìä **–û–¶–ï–ù–ö–ê –¢–†–£–î–û–ó–ê–¢–†–ê–¢**

- **–≠—Ç–∞–ø 1-2**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)
- **–≠—Ç–∞–ø 3**: TOML –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (1-2 –¥–Ω—è)
- **–≠—Ç–∞–ø 4**: CLI –∫–æ–º–∞–Ω–¥—ã (1-2 –¥–Ω—è)
- **–≠—Ç–∞–ø 5**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (1 –¥–µ–Ω—å)
- **–≠—Ç–∞–ø 6**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 –¥–µ–Ω—å)
- **–≠—Ç–∞–ø 7**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)

**–ò—Ç–æ–≥–æ: 8-12 –¥–Ω–µ–π** –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

## ‚ö†Ô∏è **–†–ò–°–ö–ò –ò –ú–ò–ì–†–ê–¶–ò–Ø**

- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –ø—Ä–æ—Ñ–∏–ª–µ–π
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**: –ù–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏

## üé≠ **–°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨**

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- **TOML**: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **JSON**: –¢–æ–ª—å–∫–æ –¥–ª—è ClientConfig (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
- **YAML**: –í–æ–∑–º–æ–∂–Ω–æ –≤ –±—É–¥—É—â–µ–º

### –ö–æ–º–∞–Ω–¥—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```bash
# –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ)
sboxctl config list
sboxctl config apply home.toml
sboxctl config switch work

# –°—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã (deprecated, –Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç)
sboxctl profile list  # ‚Üí warning + redirect
sboxctl profile apply home.json  # ‚Üí warning + migrate
```

## üèÅ **–ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò**

‚úÖ **–ì–æ—Ç–æ–≤–æ –∫–æ–≥–¥–∞:**
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] CLI –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è JSON ‚Üí TOML —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

---

**–°—Ç–∞—Ç—É—Å:** üîÑ **–í –ü–õ–ê–ù–ê–•**
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• **–í—ã—Å–æ–∫–∏–π** (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è code-quality-analysis)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** AI Assistant
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
