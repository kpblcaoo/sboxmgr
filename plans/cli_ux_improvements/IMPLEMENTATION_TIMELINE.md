# Временной план реализации улучшений CLI

**Дата создания:** 18 июля 2025
**Общая продолжительность:** 6-8 недель
**Статус:** Планирование

## Обзор этапов

### Фаза 1: Основы (Недели 1-2)
- Реорганизация структуры команд
- Технические улучшения (общие утилиты)
- Обратная совместимость

### Фаза 2: Интерактивность (Недели 3-4)
- Prompts Wizard
- Интерактивные prompts в командах
- Улучшение help-текстов

### Фаза 3: Power Users (Недели 5-6)
- Оптимизация для опытных пользователей
- Глобальные флаги
- Автоматизация

### Фаза 4: Интеграция (Недели 7-8)
- Bash-completion
- IDE интеграция
- Документация

## Ветки разработки

### Ветка-хаб
- `feature/cli-ux-improvements` - основная ветка для планирования

### Фаза 1: Основы (недели 1-2)
- `feature/cli-aliases-and-global-flags` - алиасы и глобальные флаги
- `feature/cli-subscription-group` - группа команд subscription

### Фаза 2: Интерактивность (недели 3-4)
- `feature/cli-export-subcommands` - разбиение export на подкоманды
- `feature/cli-interactive-prompts` - интерактивные prompts

### Фаза 3: Power Users (недели 5-6)
- `feature/cli-wizard-command` - интерактивный wizard
- `feature/cli-json-output` - JSON-вывод для всех команд

### Фаза 4: Интеграция (недели 7-8)
- `feature/cli-diagnose-command` - команда диагностики
- `feature/cli-bash-completion` - автодополнение

## Детальный план

### Неделя 1: Подготовка и реорганизация команд

**День 1-2: Анализ и планирование**
- [ ] Детальный анализ текущего кода CLI
- [ ] Создание схемы миграции
- [ ] Планирование обратной совместимости
- [ ] Создание тестовых сценариев

**День 3-4: Создание группы subscription**
- [x] Создание модуля `cli/commands/subscription/`
- [x] Перенос `list-servers` в `subscription list`
- [x] Расширение `exclusions` подкомандами
- [x] Добавление алиасов для старых команд

**День 5: Разбиение команды export**
- [ ] Создание подкоманд в `cli/commands/export/`
- [ ] Выделение общих опций
- [ ] Базовая реализация подкоманд

### Неделя 2: Завершение реорганизации и технические основы

**День 1-2: Завершение export**
- [ ] Реализация специфичной логики для каждой подкоманды
- [ ] Обновление help-текстов
- [ ] Тестирование подкоманд

**День 3-4: Общие утилиты**
- [ ] Создание модуля `cli/utils/`
- [ ] Реализация общих функций и декораторов
- [ ] Рефакторинг существующих команд

**День 5: Обратная совместимость**
- [ ] Тестирование алиасов
- [ ] Проверка совместимости
- [ ] Документация миграции

### Неделя 3: Интерактивные prompts

**День 1-2: Базовая инфраструктура wizard**
- [ ] Создание модуля `cli/wizard/`
- [ ] Базовый класс `SetupWizard`
- [ ] Система шагов и валидации
- [ ] Интеграция с i18n

**День 3-4: Основные шаги wizard**
- [ ] Шаг настройки подписки
- [ ] Шаг выбора типов inbound
- [ ] Шаг конфигурации inbound
- [ ] Шаг настройки вывода

**День 5: Интерактивные prompts в командах**
- [ ] Интеграция prompts в команду `export`
- [ ] Интеграция prompts в команду `subscription list`
- [ ] Проверка TTY для non-interactive режима

### Неделя 4: Завершение интерактивности и help-тексты

**День 1-2: Завершение wizard**
- [ ] Шаг генерации конфигурации
- [ ] Цветной вывод и emoji
- [ ] Прогресс-бар для длинных операций
- [ ] Возможность возврата на предыдущий шаг

**День 3-4: Улучшение help-текстов**
- [ ] Рефакторинг help-текстов
- [ ] Добавление группировки опций
- [ ] Унификация стиля описаний
- [ ] Локализация новых текстов

**День 5: Тестирование интерактивности**
- [ ] Unit-тесты для каждого шага
- [ ] Интеграционные тесты wizard
- [ ] Тестирование в non-TTY режиме
- [ ] Тестирование локализации

### Неделя 5: Power Users оптимизация

**День 1-2: Глобальные флаги**
- [ ] Добавление `--yes` и `--verbose` в main.py
- [ ] Интеграция с существующими командами
- [ ] Обновление help-текстов

**День 3-4: Конфигурация по умолчанию**
- [ ] Создание утилит для получения значений по умолчанию
- [ ] Интеграция в команды export и subscription
- [ ] Тестирование с различными конфигурациями

**День 5: Команды-алиасы**
- [ ] Реализация команды `update`
- [ ] Добавление других полезных алиасов
- [ ] Документация алиасов

### Неделя 6: Автоматизация и диагностика

**День 1-2: Улучшенная автоматизация**
- [ ] Расширение поддержки JSON-профилей
- [ ] Пакетные операции в exclusions
- [ ] Унифицированный JSON-вывод

**День 3-4: Диагностика**
- [ ] Команда `diagnose`
- [ ] Унифицированные exit codes
- [ ] Документация для автоматизации

**День 5: Тестирование power users функций**
- [ ] Тестирование глобальных флагов
- [ ] Тестирование конфигурации по умолчанию
- [ ] Тестирование JSON-вывода

### Неделя 7: Интеграция

**День 1-2: Bash-completion**
- [ ] Включение автодополнения в Typer
- [ ] Создание кастомных completers
- [ ] Документация по установке

**День 3-4: Версия и IDE интеграция**
- [ ] Добавление команды `--version`
- [ ] Создание подкоманды `version`
- [ ] Проверка TTY и адаптивный вывод

**День 5: Exit codes**
- [ ] Стандартизация exit codes
- [ ] Обновление всех команд
- [ ] Документация кодов

### Неделя 8: Завершение и документация

**День 1-2: Документация**
- [ ] Примеры автоматизации
- [ ] Инструкции по интеграции
- [ ] Примеры JSON-вывода
- [ ] Обновление README

**День 3-4: Финальное тестирование**
- [ ] Полное тестирование всех функций
- [ ] Тестирование обратной совместимости
- [ ] Тестирование в различных средах
- [ ] Performance тестирование

**День 5: Подготовка к релизу**
- [ ] Финальная проверка кода
- [ ] Обновление CHANGELOG
- [ ] Подготовка релизных заметок
- [ ] Создание миграционного гайда

## Зависимости между задачами

### Критические зависимости
1. **Общие утилиты** → **Все остальные задачи**
   - Без общих утилит сложно рефакторить команды

2. **Реорганизация команд** → **Help-тексты**
   - Help-тексты зависят от новой структуры команд

3. **Технические улучшения** → **Wizard**
   - Wizard использует общие утилиты и сервисы

### Рекомендуемая последовательность
1. Сначала технические основы
2. Затем реорганизация команд
3. Потом интерактивность
4. В конце интеграция

## Риски и митигация

### Риски задержек
- **Сложность рефакторинга** → Начать с простых команд
- **Проблемы совместимости** → Тщательное тестирование алиасов
- **Сложность wizard** → Поэтапная реализация

### Риски качества
- **Потеря функциональности** → Обширное тестирование
- **Проблемы UX** → Раннее тестирование с пользователями
- **Производительность** → Профилирование критических путей

## Метрики прогресса

### Еженедельные чекпоинты
- [ ] Все задачи недели завершены
- [ ] Тесты проходят
- [ ] Документация обновлена
- [ ] Обратная совместимость проверена

### Критерии готовности для каждого этапа
- **Фаза 1:** Новые команды работают, алиасы функционируют
- **Фаза 2:** Wizard работает, prompts интегрированы
- **Фаза 3:** Power users функции работают, JSON-вывод стабилен
- **Фаза 4:** Bash-completion работает, IDE интеграция готова

## Ресурсы

### Разработчики
- 1 основной разработчик (полный день)
- 1 тестировщик (частичная занятость)

### Инфраструктура
- Тестовая среда для проверки совместимости
- CI/CD для автоматического тестирования
- Документация для пользователей

### Внешние зависимости
- Typer/Click для автодополнения
- Rich для форматированного вывода
- Pydantic для валидации
