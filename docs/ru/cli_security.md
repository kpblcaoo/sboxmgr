# CLI Security: update-singbox

## Реализованные меры

- **Sandboxing генератора плагинов**: генерация шаблонов происходит только в разрешённые директории, без выполнения кода.
- **Валидация имён и docstring**: генератор проверяет корректность имени класса, docstring, не допускает инъекций и конфликтов.
- **Ограничение генерации файлов**: нельзя перезаписать существующие важные файлы, генерация только в src/sboxmgr/subscription/<type>s/.
- **UX для ошибок**: все ошибки генерации и CLI-команд выводятся user-friendly, без раскрытия stacktrace/секретов.
- **Edge-case тесты**: автотесты на генерацию с невалидными именами, конфликтами, ошибками шаблона.
- **Рекомендации**: не запускать генератор с root, проверять шаблоны перед использованием, не использовать уникальные/секретные строки в docstring.

## SEC-валидация inbounds (v1.5.0)
- Все inbounds проходят SEC-валидацию через pydantic (V2):
    - bind только на 127.0.0.1 или ::1 (или private network)
    - порты только 1024-65535
    - внешний bind (0.0.0.0) вызывает ошибку
- Edge-тесты покрывают ошибки профиля, конфликт портов, SEC-валидацию
- Пример:
```python
InboundProfile(type="socks", listen="0.0.0.0", port=10808)  # ValueError
InboundProfile(type="socks", listen="127.0.0.1", port=80)   # ValueError
```

## TODO / Future
- Sandboxing для всех CLI-команд (ограничение env, chroot, seccomp)
- Валидация всех пользовательских путей и параметров
- Интеграция с sec_checklist.md и edge_cases.md
- Автоматизация security-аудита CLI

_См. также: sec_checklist.md, edge_cases.md, README.md_
