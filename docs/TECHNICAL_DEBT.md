# Technical Debt

Документ для отслеживания технического долга проекта.

## Высокий приоритет

### SFI JSON Parser Support
**Статус**: Не реализовано  
**Дата добавления**: 2024-12-23  
**Описание**: Необходима поддержка SFI (Sing-box Format Interchange) - JSON формата, который возвращает готовые sing-box конфигурации вместо списка серверов.

**Проблема**:
- SFI возвращает полный sing-box конфиг: `{"dns": {...}, "outbounds": [...], "route": {...}}`
- Текущий JSONParser возвращает пустой список (заглушка)
- Нужно извлекать серверы из секции `outbounds`, игнорируя служебные (`selector`, `direct`, `block`)

**Требует**:
1. **Схемы валидации входных данных** - определить форматы входящих JSON
2. **Слои валидации** - валидация структуры, обязательных полей, типов
3. **Конвертер outbound → ParsedServer** - маппинг различных типов outbound'ов
4. **Обновление detect_parser логики** - корректное определение SFI vs обычный JSON
5. **Тесты** - покрытие различных SFI форматов

**Оценка сложности**: Высокая (требует архитектурных изменений)

**Пример URL**: `https://my.vpn.lease/s/bW9tYWlfdGdpZC00NTMwMjM1MiwxNzM4NDEyMDc2OKUh7sgx1b` (User-Agent: SFI)

---

## Средний приоритет

### Plugin Template Generator Refactoring
**Статус**: Частично реализовано (работает, но код грязный)  
**Дата добавления**: 2024-12-23  
**Описание**: Необходим рефакторинг генератора шаблонов плагинов для улучшения качества кода.

**Проблемы**:
- Логика генерации имён файлов/классов смешана с тестовым кодом
- Нарушение принципа разделения ответственности
- Антипаттерн: production код содержит test-specific логику

**Требует**:
- Выделение логики генерации в отдельные функции
- Рефакторинг именования классов/файлов
- Улучшение архитектуры генератора

**Оценка сложности**: Средняя

---

## Низкий приоритет

### Installation/Packaging Issues
**Статус**: Требует исследования  
**Дата добавления**: 2024-12-23  
**Описание**: Команда `sboxmgr` не найдена после установки, возможны проблемы с entry points.

**Требует исследования**: Проверка setup.py/pyproject.toml конфигурации

---

## Завершённые

### ✅ Sing-box 1.11.0+ Compatibility
**Статус**: Завершено  
**Дата завершения**: 2024-12-23  
**Описание**: Обновлена совместимость с sing-box 1.11.0+ - удалены deprecated legacy special outbounds, добавлены rule actions. 